<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Calendrier - Cour SuprÃªme</title>
    <link rel="stylesheet" href="dashboard.css">
</head>
<body>

<header>
    <h2>Calendrier - Cour SuÃªme</h2>
    <div>
        <span id="welcomeUser"></span>
        <button onclick="logout()">DÃ©connexion</button>
    </div>
</header>

<div class="calendar-container">
    <div id="calendar"></div>
</div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBvxjntS-Z1XrHa9a0o0N1--bssp7xym_U",
  authDomain: "dojvision-be614.firebaseapp.com",
  projectId: "dojvision-be614",
  storageBucket: "dojvision-be614.firebasestorage.app",
  messagingSenderId: "1073844982688",
  appId: "1:1073844982688:web:717e4e2d4503267ff4cac5",
  measurementId: "G-63FBJPM070"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const calendar = document.getElementById("calendar");
const user = localStorage.getItem("loggedUser") || "InvitÃ©";
document.getElementById("welcomeUser").innerText = "ConnectÃ© : " + user;

window.logout = function() {
    localStorage.removeItem("loggedUser");
    window.location.href = "index.html";
};

// ðŸ”¥ Charger en temps rÃ©el
onSnapshot(collection(db, "audiences"), (snapshot) => {
    calendar.innerHTML = "";
    snapshot.forEach((docSnap) => {
        const data = docSnap.data();
        const id = docSnap.id;

        const card = document.createElement("div");
        card.className = "event-card";
        card.innerHTML = `
            <h3>${data.time} - ${data.type}</h3>
            <p><strong>${data.name}</strong> - ${data.room}</p>
            <p style="color:#00ff88;">$ ${data.money}</p>
            <p>CrÃ©Ã© par : ${data.createdBy}</p>
            <button onclick="assignEvent('${id}')">S'assigner</button>
            <button onclick="deleteEvent('${id}')">Supprimer</button>
        `;
        calendar.appendChild(card);
    });
});

// ðŸ”¥ CrÃ©er audience
window.createEvent = async function() {
    const name = prompt("Nom audience ?");
    const room = prompt("Salle ?");
    const time = prompt("Heure ?");
    const money = prompt("Montant ?");
    const type = prompt("Type (procÃ¨s/cÃ©rÃ©monie) ?");

    await addDoc(collection(db, "audiences"), {
        name,
        room,
        time,
        money,
        type,
        createdBy: user,
        assignedTo: ""
    });
};

// ðŸ”¥ Supprimer
window.deleteEvent = async function(id) {
    await deleteDoc(doc(db, "audiences", id));
};

// ðŸ”¥ S'assigner
window.assignEvent = async function(id) {
    await updateDoc(doc(db, "audiences", id), {
        assignedTo: user
    });
};

</script>

<button onclick="createEvent()" class="create-btn">+ Nouvelle audience</button>

</body>
</html>
